If wireshark is not lying and the dlp is not broken for the elliptic curves used by openvpn 
and if your linux os has no backdoor circumventing wireshark. Then you can use voip in openvpn 
using up to 512 bits of security.
No need to use anything else to do international phonecalls.
It works fine and feels great. No third parties besides the vps that is helping with the holepunch.
This project is also great for someone that wishes to learn how to code since it 
contains all the basics, without pointers...

Every phone needs to have a different ip address. 

Because after sip, when the rtp stream starts it uses the addresses from the caller and the callee 
wich are on the phones. Besides that the ip addresses of the phones are totally irrelevant. 
If the phones would have the same ip address then sip works 
but the phone would be calling itself so it does not send the rtp packets out it's gateway.

The range of the phone numbers goes from :
172.16.0.0 to
172.28.255.252

This number is set directly on the phone itself. 
Use also, sudo -E python3 main.py, again to define the phone number aswell as the gateway.

Every phone number needs to be distinct. Now because of the birthday's paradox :

The range implies 13 * ( 2 ^ 16 ) addresses .
13 because 13 = (28 - 16) + 1 .
so 13 * ( 2 ^ 16 ) = 851968 addresses .
Because we are dealing with /30 we divide by 2 
having 425984 usable addresses one for the phone and one for the gateway.
Now as we are dealing with sets just as with days we divide by 2 again.
having 212992 networks. Now if instead of 365 days we would have 212992 days, 
then if there are 544 phones in the system that choose their ip address randomly 
then it is likely that there will be two that will have the same ip address.

This could be addressed in two ways adopting ipv6 in a future version having the tradeoff 
that an user might need to call numbers such as fd68:cafe:beef:dead:feeb:feed:deaf:face 
wich could become a burden. Or every user asks it's 500 connected servers and clients : 
does someone have the same ip for the phone? And if yes then that gets resolved. 
Notice when a user is connected to 255 servers and has 255 clients every one of them 
can use the same ip address on the phone. 
Because it is not transitive, there is no client to client connection, 
this should be fine.

The code for the vps is also given, which includes the creation and deletion of sftp users 
for read and write and only read. And also a script that joins two peers using udp sockets.

In the vps folder, there are scripts that let you have your own vps service.
Users can use your static public IPv4 address and pay you for being the rendezvous point of
the udp holepunch. This was done with electrum.

Here is the rough outline on how a user would acquire the credentials to use your vps : 
Use at own risk :


1) gpg --full-generate-key

in here, give your user name, or "uid". Let's say it's bob.

2) gpg --export --armor --output newuser bob

3) connect to the cloud over sftp.

4) get address

4)Ö)
   bc1qgpschlf2hrv2pgthdq52ksurnwaqzn7kk9pupv
   is just an example address, that you would find in the text file called address.
   You then take that address and put it in the 2nd line of the newuser file.

5) edit the newuser file, which contains your public key.
   as such :
 
   bob<br/>
   bc1qgpschlf2hrv2pgthdq52ksurnwaqzn7kk9pupv<br/>
   yourpublickey

5)Ö)
   This means, the text file "newuser" . Shall be edited as follows :
   
   bob (Line 1 of text file) <br/>
   bc1qgpschlf2hrv2pgthdq52ksurnwaqzn7kk9pupv (Line 2 of text file) <br/>
   yourpublickey (starting from line 3 until the end of text file)

6) put newuser

7) transact 0.0012 btc to the given address. You have 3 hours to have it confirmed.

8) After confirmation, a file with that address name will be @ newuser@someip

9) get bc1qgpschlf2hrv2pgthdq52ksurnwaqzn7kk9pupv

10) gpg --output creds --decrypt bc1qgpschlf2hrv2pgthdq52ksurnwaqzn7kk9pupv

11) now your credentials are with you, you can type them in when using 

sudo -E python3 main.py

Your credentials will be deleted after 4 hours.
only one payment can be processed every 3 hours.



A rc.local example is given. The /etc/rc.local then calls a so called caller.sh at boot time.
This lets two scripts run in the background. These are the server_deamon.py ( not daemon )
and the clients_deamon.py. 
Also a small script called rp_filter is executed to allow forwarding and turning off rp_filter 
and turning on accept_local.
       
Creating new clients to our own openvpn server should be straight forward 
aswell as creating new clients connections to other servers. 
The output of main.py should be self explanatory.

Some confusion could arise from creating access credentials .
What is happening is that when a client connects to the server it does so using a vps 
as a rendezvous point, for the udp holepunch. 
So in this regard the client is a peer and the server is a peer. 
Each needs to know if the other is online. 
Furthermore this is a multi-cloud situation because the server might be at one vps 
and the client might be at another vps. 
And the client always connects to the server using the vps of the server.
The client already has the access credentials in the modified openvpn certificate.
But the server does not. So the client creates an access credentials file for the server.
This is a sftp read connection for only one file called DoA and stands for Dead or Alive.
The server then needs to import this access credentials file.
These are the two last options in the main.py.



No Voice mail is supported ...
Conference calls are not supported. They might be implemented in the future, 
if a more elaborate patch can be done to listen on the wire.
Putting calls on hold works. ( a feature of the GXP-1610 )

Currently there is no possibility of having a client-to-client connection. 
Therefore s=1 for every client, because every client only connects to the server. 
Moreover p=1, as this is targeted firstly at raspberry pi's these only have one ethernet port
and thus only one phone can connect to it. 
This is in part because of a patch handling sip and rtp, using tcpdump to listen on the wire.
This project works with the GXP-1610, 
and it is assumed that it works with every ip phone that is able to do direct ip calls without proxy.
The exchange of audio codecs seems to work fine, and is interoperable on these "new" ip phones.
The YEA SIP-T19P makes outbound calls but does not receive them. 
This might be tweakable on the settings of the phone via web interface. (there are a lot)

and decentralized google is doodle 

:)
